<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css">


  <meta name="keywords" content="JavaScript,Vue,源码分析,">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.1">






<meta name="description" content="如果您是刚开始准备阅读Vue.js的源码，建议先看一下本系列的Vue.js源码学习 —— 起步，相信会对您后面的阅读有很大帮助。 这篇是接着上一篇Vue.js源码学习 —— 合并选项前的预处理，也建议您先看一下，然后再来看这篇会轻松很多。 这篇文章要看的代码主要位于文件core/util/options.js中。  我没有在文章中大量的贴源码，一定要将源码clone到本地哦。  预备知识Vue.o">
<meta name="keywords" content="JavaScript,Vue,源码分析">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue.js源码学习 —— 选项的合并策略">
<meta property="og:url" content="http://shinancao.github.io/2020/01/10/Vue-Source-Code-02/index.html">
<meta property="og:site_name" content="意林的小站">
<meta property="og:description" content="如果您是刚开始准备阅读Vue.js的源码，建议先看一下本系列的Vue.js源码学习 —— 起步，相信会对您后面的阅读有很大帮助。 这篇是接着上一篇Vue.js源码学习 —— 合并选项前的预处理，也建议您先看一下，然后再来看这篇会轻松很多。 这篇文章要看的代码主要位于文件core/util/options.js中。  我没有在文章中大量的贴源码，一定要将源码clone到本地哦。  预备知识Vue.o">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2020-07-29T04:33:00.752Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Vue.js源码学习 —— 选项的合并策略">
<meta name="twitter:description" content="如果您是刚开始准备阅读Vue.js的源码，建议先看一下本系列的Vue.js源码学习 —— 起步，相信会对您后面的阅读有很大帮助。 这篇是接着上一篇Vue.js源码学习 —— 合并选项前的预处理，也建议您先看一下，然后再来看这篇会轻松很多。 这篇文章要看的代码主要位于文件core/util/options.js中。  我没有在文章中大量的贴源码，一定要将源码clone到本地哦。  预备知识Vue.o">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shinancao.github.io/2020/01/10/Vue-Source-Code-02/">





  <title>Vue.js源码学习 —— 选项的合并策略 | 意林的小站</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">意林的小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Be a cool girl ~</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-portfolio">
          <a href="/portfolio/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-code"></i> <br>
            
            项目
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://shinancao.github.io/2020/01/10/Vue-Source-Code-02/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="意林">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="意林的小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">Vue.js源码学习 —— 选项的合并策略</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-10T16:40:32+08:00">
                2020-01-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/Vue/" itemprop="url" rel="index">
                    <span itemprop="name">Vue</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>如果您是刚开始准备阅读Vue.js的源码，建议先看一下本系列的<a href="http://shinancao.cn/2020/01/05/Vue-Source-Code-00/" target="_blank" rel="noopener">Vue.js源码学习 —— 起步</a>，相信会对您后面的阅读有很大帮助。</p>
<p>这篇是接着上一篇<a href="http://shinancao.cn/2020/01/07/Vue-Source-Code-01/" target="_blank" rel="noopener">Vue.js源码学习 —— 合并选项前的预处理</a>，也建议您先看一下，然后再来看这篇会轻松很多。</p>
<p>这篇文章要看的代码主要位于文件<code>core/util/options.js</code>中。</p>
<blockquote>
<p>我没有在文章中大量的贴源码，一定要将源码clone到本地哦。</p>
</blockquote>
<h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><h3 id="Vue-options"><a href="#Vue-options" class="headerlink" title="Vue.options"></a>Vue.options</h3><p>上一篇<a href="http://shinancao.cn/2020/01/07/Vue-Source-Code-01/" target="_blank" rel="noopener">Vue.js源码学习 —— 合并选项前的预处理</a>中有说过<code>Vue.options</code>的内容，这里再复习一下，为了便于在举例子时说明结果：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  components: &#123;</span><br><span class="line">    KeepAlive,</span><br><span class="line">    Transition,</span><br><span class="line">    TransitionGroup</span><br><span class="line">  &#125;,</span><br><span class="line">  directives: &#123;</span><br><span class="line">    model,</span><br><span class="line">    show</span><br><span class="line">  &#125;,</span><br><span class="line">  filters: &#123;&#125;,</span><br><span class="line">  _base: ƒ Vue(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="extend函数"><a href="#extend函数" class="headerlink" title="extend函数"></a>extend函数</h3><p>需要了解工具函数<code>extend</code>的实现，因为在合并的过程中会经常使用到。<code>extend</code>函数位于文件<code>shared/util.js</code>中，代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Mix properties into target object.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">extend</span> (<span class="params">to: Object, _from: ?Object</span>): <span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> _from) &#123;</span><br><span class="line">    to[key] = _from[key]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> to</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>extend</code>函数接收两个对象<code>to</code>和<code>from</code>，并将<code>from</code>中的键值对混入到<code>to</code>中，最后返回<code>to</code>。这背后的几点含义：</p>
<ul>
<li>在<code>to</code>和<code>from</code>中有相同<code>key</code>时，<code>from</code>中的值会覆盖<code>to</code>中的值。</li>
<li><code>to</code>中不在<code>from</code>中的<code>key</code>仍然保留。</li>
<li><code>from</code>中不在<code>to</code>中的键值对，会被添加到<code>to</code>中。</li>
</ul>
<p>所以下面的合并选项中，如果用到了<code>extend</code>函数的，就是采用了覆盖的策略。</p>
<h2 id="各个选项的合并策略"><a href="#各个选项的合并策略" class="headerlink" title="各个选项的合并策略"></a>各个选项的合并策略</h2><p>从文件的最上面开始看吧。</p>
<h3 id="自定义合并选项的策略"><a href="#自定义合并选项的策略" class="headerlink" title="自定义合并选项的策略"></a>自定义合并选项的策略</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Option overwriting strategies are functions that handle</span></span><br><span class="line"><span class="comment"> * how to merge a parent option value and a child option</span></span><br><span class="line"><span class="comment"> * value into the final value.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> strats = config.optionMergeStrategies</span><br></pre></td></tr></table></figure>
<p><code>config.optionMergeStrategies</code>是提供给开发者使用的，我们可以自定义父选项和子选项要怎样合并，通常用于自定义的选项的合并。可以在<a href="https://cn.vuejs.org/v2/guide/mixins.html#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%80%89%E9%A1%B9%E5%90%88%E5%B9%B6%E7%AD%96%E7%95%A5" target="_blank" rel="noopener">官方文档#自定义选项合并策略</a>一节了解具体如何使用。</p>
<h3 id="el和propsData选项的合并策略"><a href="#el和propsData选项的合并策略" class="headerlink" title="el和propsData选项的合并策略"></a>el和propsData选项的合并策略</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Options with restrictions</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">  strats.el = strats.propsData = <span class="function"><span class="keyword">function</span> (<span class="params">parent, child, vm, key</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">`option "<span class="subst">$&#123;key&#125;</span>" can only be used during instance `</span> +</span><br><span class="line">        <span class="string">'creation with the `new` keyword.'</span></span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> defaultStrat(parent, child)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>el</code> 和 <code>propsData</code>两个选项只能用于<code>Vue</code>的实例对象中，也就是说不能直接在<code>Vue</code>或其子类的构造器选项中设置<code>el</code> 和 <code>propsData</code>，开发环境下会给出警告信息。</p>
<blockquote>
<p><a href="https://cn.vuejs.org/v2/api/#propsData" target="_blank" rel="noopener"><code>propsData</code></a> 用于在创建实例时传递 props。主要作用是方便测试。</p>
</blockquote>
<h3 id="data选项的合并策略"><a href="#data选项的合并策略" class="headerlink" title="data选项的合并策略"></a>data选项的合并策略</h3><p><code>data</code>选项此时并没有真正执行合并，只是返回了一个函数，真正地合并过程在该函数中。当合并发生在创建子类构造器时，会返回<code>mergedDataFn</code>函数，当合并发生在创建实例对象时，会返回<code>mergedInstanceDataFn</code>函数。</p>
<blockquote>
<p>这相当于是延迟了合并<code>data</code>选项。因为<code>data</code>中的计算有可能依赖了<code>props</code>选项中的内容，所以需要在初始化<code>props</code>之后，才能去真正地执行<code>data</code>的合并。</p>
</blockquote>
<p>先从下面这段代码开始看：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">strats.data = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentVal: any,</span></span></span><br><span class="line"><span class="function"><span class="params">  childVal: any,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm?: Component</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): ?<span class="title">Function</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!vm) &#123;</span><br><span class="line">    <span class="keyword">if</span> (childVal &amp;&amp; <span class="keyword">typeof</span> childVal !== <span class="string">'function'</span>) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; warn(</span><br><span class="line">        <span class="string">'The "data" option should be a function '</span> +</span><br><span class="line">        <span class="string">'that returns a per-instance value in component '</span> +</span><br><span class="line">        <span class="string">'definitions.'</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> parentVal</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mergeDataOrFn(parentVal, childVal)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> mergeDataOrFn(parentVal, childVal, vm)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>vm</code>有值时，合并发生在创建实例对象时，在<code>vm</code>没有值时，也就是没有传<code>vm</code>时，合并发生在创建子类构造器时。我们知道创建子类构造器使用<code>Vue.extend</code>，看一下它的实现，发现确实是没有传的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sub.options = mergeOptions(</span><br><span class="line">  Super.options,</span><br><span class="line">  extendOptions</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>而在<code>Vue.prototype._init</code>中始终都会传<code>vm</code>。</p>
<p>当合并发生在创建子类构造器时，那<code>data</code>选项的类型必须是一个函数，如果不是，开发环境下会给出警告信息。</p>
<blockquote>
<p>为什么此时<code>data</code>选项的类型必须是一个函数呢？</p>
</blockquote>
<p>通过前面的分析，我们知道构造器的选项会与其所有实例对象的选项合并，就会导致<code>data</code>在所有的实例对象中共享。如果<code>data</code>是一个普通对象，就会导致一个使用了该组件的实例对象改变了<code>data</code>中的值时，其他使用该组件的实例对象获取到的<code>data</code>也会受影响。<code>data</code>是函数时，所有实例对象拥有的是函数返回值的副本，所以不会有影响。</p>
<p>再接着看<code>mergeDataOrFn</code>函数，在<code>vm</code>没有值，也就是合并发生在创建子类构造器时，是直接将<code>childVal</code>或<code>parentVal</code>返回的，并没有用函数来包装，所以开发者此时一定要传函数。</p>
<p>还是通过例子一步一步来看，先举个合并发生在创建子类构造器时的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// data option in constructors</span></span><br><span class="line"><span class="keyword">const</span> Parent = Vue.extend(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">foo</span>: <span class="string">'foo'</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时<code>parent</code>是<code>Vue</code>构造器的<code>options</code>，因为<code>Vue.options</code>中没有<code>data</code>选项，所以<code>parentVal</code>是<code>undefined</code>，<code>childVal</code>是我们给<code>Parent</code>传的<code>data</code>，因此执行了<code>mergeDataOrFn</code>函数中的下面这段：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!parentVal) &#123;</span><br><span class="line">  <span class="keyword">return</span> childVal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着上面，再加上一个继承自<code>Parent</code>的子类：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Child = Parent.extend(&#123;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>经过上一步的合并后，此时<code>Parent.options.data</code>有值了，也就是<code>parentVal</code>有值了。但是因为我们没有在<code>Child</code>中传<code>data</code>选项，所以<code>childVal</code>为<code>undefined</code>，此时执行了<code>mergeDataOrFn</code>函数中的下面这段：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!childVal) &#123;</span><br><span class="line">  <span class="keyword">return</span> parentVal</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在给上面的<code>Child</code>传个<code>data</code>选项：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Child = Parent.extend(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">bar</span>: <span class="string">'bar'</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>就会执行到下面的语句：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// when parentVal &amp; childVal are both present,</span></span><br><span class="line"><span class="comment">// we need to return a function that returns the</span></span><br><span class="line"><span class="comment">// merged result of both functions... no need to</span></span><br><span class="line"><span class="comment">// check if parentVal is a function here because</span></span><br><span class="line"><span class="comment">// it has to be a function to pass previous merges.</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">mergedDataFn</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> mergeData(</span><br><span class="line">    <span class="keyword">typeof</span> childVal === <span class="string">'function'</span> ? childVal.call(<span class="keyword">this</span>, <span class="keyword">this</span>) : childVal,</span><br><span class="line">    <span class="keyword">typeof</span> parentVal === <span class="string">'function'</span> ? parentVal.call(<span class="keyword">this</span>, <span class="keyword">this</span>) : parentVal</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时<code>data</code>返回了<code>mergedDataFn</code>函数。该函数中又调用了<code>mergeData</code>函数，传给它的参数，如果<code>data</code>是函数，就是<code>data</code>执行后的返回结果。如果<code>data</code>是对象，就是该对象。总之传给<code>mergeData</code>函数的是两个对象了。</p>
<p>再看当合并发生在创建实例对象时，直接举个<code>parentVal</code>和<code>childVal</code>都有值的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// data option in instance object</span></span><br><span class="line"><span class="keyword">const</span> VueChild = Vue.extend(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">foo</span>: <span class="string">'foo'</span>&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> VueChild(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">bar</span>: <span class="string">'bar'</span> &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时<code>data</code>返回的是<code>mergedInstanceDataFn</code>函数。该函数也是调用了<code>mergeData</code>函数，给它的传参处理逻辑与构造器是很像，区别在于如果<code>data</code>是函数，在<code>mergedDataFn</code>函数中调用<code>data</code>传的是<code>this</code>，而<code>mergedInstanceDataFn</code>函数中调用<code>data</code>传的是<code>vm</code>。所以<code>data</code>选项在是函数时，还可以接收一个参数。</p>
<p>再看<code>mergeData</code>函数内部的实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeData</span> (<span class="params">to: Object, from: ?Object</span>): <span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!<span class="keyword">from</span>) <span class="keyword">return</span> to</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">return</span> to</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整个函数做的事情就是将<code>from</code>对象中的属性合并到<code>to</code>对象中，最后将<code>to</code>返回。先获取<code>from</code>对象中的所有<code>keys</code>，然后分了几种情况处理：</p>
<ol>
<li><p>如果<code>key</code>正在被观察，不做处理。</p>
</li>
<li><p>如果<code>key</code>不在<code>to</code>对象中，将调用<code>set</code>函数将该属性设置到<code>to</code>对象中。这个<code>set</code>函数位于<code>observer/index.js</code>中，因为里面牵扯到响应系统的东西，所以暂时先不细看。</p>
</li>
<li><p>如果<code>key</code>在<code>to</code>对象中：</p>
<ul>
<li>如果在<code>from</code>中和<code>to</code>中的属性值都是对象，并且没有指向一个相同的对象，就递归调用<code>mergeData</code>函数进一步合并。</li>
<li>其他情况时（属性值是原始值或数组等）都保留了<code>to</code>对象中的。</li>
</ul>
</li>
</ol>
<p>举个例子，可以放到浏览器中调试看看执行的过程：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mergeData test</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">  firstName: <span class="string">'Ida'</span>,</span><br><span class="line">  lastName: <span class="string">'Zhang'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> VueChild = Vue.extend(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; </span><br><span class="line">      foo: <span class="string">'foo'</span>,</span><br><span class="line">      obj: obj,</span><br><span class="line">      list: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> VueChild(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params">context</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo: <span class="string">'bar'</span>,</span><br><span class="line">      obj: obj,</span><br><span class="line">      list2: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>合并后<code>vm.$options.data</code>如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    foo: <span class="string">'bar'</span>,</span><br><span class="line">    obj: &#123;</span><br><span class="line">      firstName: <span class="string">'Ida'</span>,</span><br><span class="line">      lastName: <span class="string">'Zhang'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    list: [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>],</span><br><span class="line">    list2: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="实例生命周期钩子选项的合并策略"><a href="#实例生命周期钩子选项的合并策略" class="headerlink" title="实例生命周期钩子选项的合并策略"></a>实例生命周期钩子选项的合并策略</h3><p>从下面这段代码开始看：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LIFECYCLE_HOOKS.forEach(<span class="function"><span class="params">hook</span> =&gt;</span> &#123;</span><br><span class="line">  strats[hook] = mergeHook</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>LIFECYCLE_HOOKS</code>在<code>shared/constants.js</code>文件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> LIFECYCLE_HOOKS = [</span><br><span class="line">  <span class="string">'beforeCreate'</span>,</span><br><span class="line">  <span class="string">'created'</span>,</span><br><span class="line">  <span class="string">'beforeMount'</span>,</span><br><span class="line">  <span class="string">'mounted'</span>,</span><br><span class="line">  <span class="string">'beforeUpdate'</span>,</span><br><span class="line">  <span class="string">'updated'</span>,</span><br><span class="line">  <span class="string">'beforeDestroy'</span>,</span><br><span class="line">  <span class="string">'destroyed'</span>,</span><br><span class="line">  <span class="string">'activated'</span>,</span><br><span class="line">  <span class="string">'deactivated'</span>,</span><br><span class="line">  <span class="string">'errorCaptured'</span>,</span><br><span class="line">  <span class="string">'serverPrefetch'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>这里列出了所有的实例对象生命周期的钩子函数，这表示所有的钩子函数用的都是一样的合并策略。在构造器中有这些钩子函数时，而开发者又传入了同样的钩子函数，会将两个一样的钩子函数合并成一个数组，重新作为选项的值。即使构造器中没有相同的钩子函数，也会将传入的钩子函数放入数组中，重新作为选项的值。</p>
<p>实现实例对象生命周期钩子选项的合并策略的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeHook</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentVal: ?Array&lt;Function&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">  childVal: ?Function | ?Array&lt;Function&gt;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): ?<span class="title">Array</span>&lt;<span class="title">Function</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = childVal</span><br><span class="line">    ? parentVal</span><br><span class="line">      ? parentVal.concat(childVal)</span><br><span class="line">      : <span class="built_in">Array</span>.isArray(childVal)</span><br><span class="line">        ? childVal</span><br><span class="line">        : [childVal]</span><br><span class="line">    : parentVal</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">    ? dedupeHooks(res)</span><br><span class="line">    : res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mergeHook</code>函数会将<code>parentVal</code>和<code>childVal</code>进行合并，返回的始终是一个放钩子函数的数组。<code>dedupeHooks</code>函数是对数组去重的。<code>parentVal</code>是来自构造器的选项，从它的类型注释上可以看出，它有值时肯定是一个数组。还是来举例说明这是什么情况下出现的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> VueChild = Vue.extend(&#123;</span><br><span class="line">  created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'VueChild created called'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时<code>parentVal</code>是<code>Vue.options.created</code>，所以是<code>undefined</code>。而<code>childVal</code>就是我们上面传的<code>created</code>，经过<code>mergeHook</code>函数合并后，<code>VueChild.options.created</code>变成下面这样：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  created: f ()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们再创建一个<code>VueChild</code>的实例对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> VueChild(&#123;</span><br><span class="line">  created: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'vm created called'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时<code>parentVal</code>是<code>VueChild.options.created</code>，所以<code>parentVal</code>一旦有值就是已经合并过了，变成了一个数组。此时<code>childVal</code>还是我们上面传的<code>created</code>。这样合并后<code>vm.options.created</code>就变成了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  created: [f (), f ()]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="资源选项的合并策略"><a href="#资源选项的合并策略" class="headerlink" title="资源选项的合并策略"></a>资源选项的合并策略</h3><p>从下面这段代码开始看：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ASSET_TYPES.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">type</span>) </span>&#123;</span><br><span class="line">  strats[type + <span class="string">'s'</span>] = mergeAssets</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>ASSET_TYPES</code>定义在<code>shared/constants.js</code>文件中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ASSET_TYPES = [</span><br><span class="line">  <span class="string">'component'</span>,</span><br><span class="line">  <span class="string">'directive'</span>,</span><br><span class="line">  <span class="string">'filter'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>所以这里的资源选项是指：<code>components</code>、<code>directives</code> 和 <code>filters</code>。这几个选项都是哈希表，并使用一样的合并策略。将构造器中的选项作为合并后的选项的原型，开发者传入的选项正常混入到合并后的选项中。我们已经知道了<code>Vue.options</code>中一开始就有这几个选项，所以它们会被合并到所有实例对象或子类构造器的这个几个选项的原型中。这就使得内置的组件和指令不需要开发者显示地注册，就能正常使用了。</p>
<p>如果传了这几个选项，必须是对象类型的，否则在开发环境下会给警告。</p>
<p>实现资源选项合并策略的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Assets</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * When a vm is present (instance creation), we need to do</span></span><br><span class="line"><span class="comment"> * a three-way merge between constructor options, instance</span></span><br><span class="line"><span class="comment"> * options and parent options.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mergeAssets</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentVal: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  childVal: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm?: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  key: string</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="built_in">Object</span>.create(parentVal || <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">if</span> (childVal) &#123;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">'production'</span> &amp;&amp; assertObjectType(key, childVal, vm)</span><br><span class="line">    <span class="keyword">return</span> extend(res, childVal)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>const res = Object.create(parentVal || null)</code>也就相当于<code>res.__proto__ = parentVal || null</code>。</p>
<p>下面还是通过举个例子一步一步来看一下合并过程，你可以直接放在浏览器中打断点看看哦。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// merge components options</span></span><br><span class="line"><span class="keyword">const</span> ButtonCounter = Vue.component(<span class="string">'button-counter'</span>, &#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这里<code>parentVal</code>是<code>Vue.options.components</code>，<code>childVal</code>是<code>undefined</code>，因为我们没有传入<code>components</code>选项。经过<code>mergeAssets</code>函数合并后，<code>ButtonCounter.options.components</code>此时为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">'components'</span>: &#123;</span><br><span class="line">    <span class="string">'__proto__'</span>: &#123;</span><br><span class="line">      KeepAlive,</span><br><span class="line">      Transition,</span><br><span class="line">      TransitionGroup</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再使用<code>ButtonCounter</code>组件创建一个<code>Vue</code>实例对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  components: &#123;</span><br><span class="line">    <span class="string">'ButtonCounter'</span>: ButtonCounter</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时还是<code>Vue.options.components</code>与我们传入的<code>components</code>选项合并。因为<code>Vue.component</code>的作用就是注册一个全局组件，所以现在<code>Vue.options.components</code>中多了一个<code>button-counter</code>组件，经过<code>mergeAssets</code>函数合并后<code>vm.options.components</code>现在为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">'components'</span>: &#123;</span><br><span class="line">    ButtonCounter,</span><br><span class="line">    <span class="string">'__proto__'</span>: &#123;</span><br><span class="line">      KeepAlive,</span><br><span class="line">      Transition,</span><br><span class="line">      TransitionGroup,</span><br><span class="line">      <span class="string">'button-counter'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里举的是<code>components</code>的例子，<code>directives</code>和<code>filters</code>也是一样的合并过程。</p>
<p>这也就解释了在<a href="http://shinancao.cn/2020/01/07/Vue-Source-Code-01/" target="_blank" rel="noopener">合并选项前的预处理#传参</a>一节中说到的，与<code>Vue.options</code>合并后的<code>app.$options</code>中的<code>components</code>、<code>directives</code>的样子。</p>
<h3 id="watch选项的合并策略"><a href="#watch选项的合并策略" class="headerlink" title="watch选项的合并策略"></a>watch选项的合并策略</h3><p><code>watch</code>选项也是一个哈希表，<code>key</code>是需要观察的表达式，<code>value</code>是对应回调函数。<code>value</code>也可以是方法名，或者包含选项的对象。</p>
<p><code>watch</code>选项的合并策略是，在开发者传入的<code>watch</code>选项中的<code>key</code>如果和构造器的<code>watch</code>选项中的<code>key</code>一样时，会将两者合并成一个数组，并重新作为该<code>key</code>对应的<code>value</code>。这就是使得在被观察的<code>key</code>发生改变时，所有<code>watch</code>该<code>key</code>的地方都会得到执行。</p>
<p>实现<code>watch</code>选项的合并策略的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Watchers.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Watchers hashes should not overwrite one</span></span><br><span class="line"><span class="comment"> * another, so we merge them as arrays.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">strats.watch = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentVal: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  childVal: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm?: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  key: string</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): ?<span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="comment">// work around Firefox's Object.prototype.watch...</span></span><br><span class="line">  <span class="keyword">if</span> (parentVal === nativeWatch) parentVal = <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">if</span> (childVal === nativeWatch) childVal = <span class="literal">undefined</span></span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (!childVal) <span class="keyword">return</span> <span class="built_in">Object</span>.create(parentVal || <span class="literal">null</span>)</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    assertObjectType(key, childVal, vm)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) <span class="keyword">return</span> childVal</span><br><span class="line">  <span class="keyword">const</span> ret = &#123;&#125;</span><br><span class="line">  extend(ret, parentVal)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> key <span class="keyword">in</span> childVal) &#123;</span><br><span class="line">    <span class="keyword">let</span> parent = ret[key]</span><br><span class="line">    <span class="keyword">const</span> child = childVal[key]</span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !<span class="built_in">Array</span>.isArray(parent)) &#123;</span><br><span class="line">      parent = [parent]</span><br><span class="line">    &#125;</span><br><span class="line">    ret[key] = parent</span><br><span class="line">      ? parent.concat(child)</span><br><span class="line">      : <span class="built_in">Array</span>.isArray(child) ? child : [child]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>nativeWatch</code>的定义在<code>core/util/env.js</code>中，内容如下。看注释也可以知道因为火狐浏览器中的<code>Object</code>原型上本来就有<code>watch</code>函数，为了跟Vue中的<code>watch</code>选项不混淆，当组件选项是浏览器原生的<code>watch</code>函数时，就重置为<code>undefined</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Firefox has a "watch" function on Object.prototype...</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> nativeWatch = (&#123;&#125;).watch</span><br></pre></td></tr></table></figure>
<p>剩下的代码明面意思不难看懂，我们还是通过例子来看一下每种情况合并后的结果。先看<code>parentVal</code>是<code>undefined</code>，<code>childVal</code>有值的情况：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// merge watch options</span></span><br><span class="line"><span class="keyword">const</span> VueChild = Vue.extend(&#123;</span><br><span class="line">  data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      foo: <span class="string">'foo'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    foo: <span class="function"><span class="keyword">function</span> (<span class="params">val, oldVal</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'new: %s, old: %s'</span>, val, oldVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>上面的例子在合并<code>watch</code>选项时，<code>parentVal</code>是<code>Vue.options.watch</code>，所以是<code>undefined</code>的。<code>childVal</code>是我们传入的<code>watch</code>选项。此时会执行<code>if (!parentVal) return childVal</code>将<code>childVal</code>直接返回，所以合并后<code>VueChild.options.watch</code>如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  watch: &#123;</span><br><span class="line">    foo: f (val, oldVal)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再接着看<code>parentVal</code>有值，但是<code>childVal</code>是<code>undefined</code>的情况，沿用上面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> VueChild(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    bar: <span class="string">'bar'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时<code>parentVal</code>是<code>VueChild.options.watch</code>，肯定有值啦，<code>childVal</code>是我们传入的选项，上面的例子中没有传<code>watch</code>选项，所以<code>childVal</code>是<code>undefined</code>的。这会执行<code>if (!childVal) return Object.create(parentVal || null)</code>，返回以<code>parentVal</code>为原型创建的对象。合并后<code>vm.$options.watch</code>为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  watch: &#123;</span><br><span class="line">    <span class="string">'__proto__'</span>: &#123;</span><br><span class="line">      foo: f (val, oldVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在给上面的例子中传入一个<code>watch</code>选项，就会使得<code>parentVal</code>和<code>childVal</code>都有值了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> VueChild(&#123;</span><br><span class="line">  el: <span class="string">'#app'</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    bar: <span class="string">'bar'</span></span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    bar: <span class="function"><span class="keyword">function</span>(<span class="params">val, oldVal</span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'new: %s, old: %s'</span>, val, oldVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这时会先将<code>parentVal</code>中的内容放入结果中，然后再将<code>childVal</code>中的内容混入进去，在混入的过程中，<code>childVal</code>中的属性值都会变成数组，如果与<code>parentVal</code>中有重复的就合并在一个数组中。<code>parentVal</code>中没有与<code>childVal</code>中重合的部分自然就还保留是函数（在“预备知识”中介绍过<code>extend</code>函数的作用了）。上面的例子合并后<code>vm.$options.watch</code>为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  watch: &#123;</span><br><span class="line">    bar: [f],</span><br><span class="line">    foo: f (val, oldVal)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="props、methods、inject、computed选项的合并策略"><a href="#props、methods、inject、computed选项的合并策略" class="headerlink" title="props、methods、inject、computed选项的合并策略"></a>props、methods、inject、computed选项的合并策略</h3><p><code>props</code>、<code>methods</code>、<code>inject</code>、<code>computed</code>这几个选项也是哈希表，并且用的是一样的合并策略。在构造器和开发者传入的这些选项中，如果有相同的<code>key</code>，会用实例对象中该<code>key</code>的值覆盖掉构造器中该<code>key</code>的值。</p>
<p>这几个选项的类型必须是对象，否则在开发环境下会给出警告。</p>
<blockquote>
<p> <code>props</code>和<code>inject</code>虽然允许开发者设置为数组，但是前面在选项规范化的时候，Vue内部已经将其规范成了对象。</p>
</blockquote>
<p>代码中实现这几个选项的合并策略的代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Other object hashes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">strats.props =</span><br><span class="line">strats.methods =</span><br><span class="line">strats.inject =</span><br><span class="line">strats.computed = <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  parentVal: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  childVal: ?Object,</span></span></span><br><span class="line"><span class="function"><span class="params">  vm?: Component,</span></span></span><br><span class="line"><span class="function"><span class="params">  key: string</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): ?<span class="title">Object</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (childVal &amp;&amp; process.env.NODE_ENV !== <span class="string">'production'</span>) &#123;</span><br><span class="line">    assertObjectType(key, childVal, vm)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!parentVal) <span class="keyword">return</span> childVal</span><br><span class="line">  <span class="keyword">const</span> ret = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">  extend(ret, parentVal)</span><br><span class="line">  <span class="keyword">if</span> (childVal) extend(ret, childVal)</span><br><span class="line">  <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码不多解释了，我们还是直接将其对应到实际开发中的场景，举个例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// merge props</span></span><br><span class="line"><span class="keyword">const</span> VueChild = Vue.extend(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    foo: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    bar: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时<code>parentVal</code>来自<code>Vue.options.props</code>，所以是<code>undefined</code>。<code>childVal</code>是我们上面传的<code>props</code>选项，是有值的。此时执行<code>if (!parentVal) return childVal</code>，直接将<code>childVal</code>作为结果返回。所以合并后的<code>VueChild.options.props</code>如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    foo: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">    &#125;,</span><br><span class="line">    bar: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着上面的例子，创建一个<code>VueChild</code>的实例对象：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> VueChild(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    foo: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'foo'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>此时<code>parentVal</code>来自<code>VueChild.options.props</code>，已经有值了。<code>childVal</code>是我们传入的<code>props</code>选项，也是有值的。此时会先创建一个空对象，先将<code>parentVal</code>中的键值对放入进去，然后再将<code>childVal</code>中的键值对混入进这个对象。此时得到<code>vm.$options.props</code>如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    foo: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">'foo'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    bar: &#123;</span><br><span class="line">      type: <span class="built_in">String</span>,</span><br><span class="line">      <span class="keyword">default</span>: <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里举的是<code>props</code>选项的例子，其他几个选项的合并过程也一样。</p>
<h3 id="provide选项的合并策略"><a href="#provide选项的合并策略" class="headerlink" title="provide选项的合并策略"></a>provide选项的合并策略</h3><p><code>provide</code>选项的合并使用的是<code>mergeDataOrFn</code>函数，这个在说<code>data</code>选项时已经介绍过了，就不赘述了。</p>
<p>选项的合并基本就这些了，基本覆盖了在<a href="https://cn.vuejs.org/v2/api/#%E9%80%89%E9%A1%B9-%E6%95%B0%E6%8D%AE" target="_blank" rel="noopener">官方API文档</a>列出的所有选项。在说每个合并策略时，我都举了简单但却能说明问题的例子，希望你能到浏览器中真的去调试一遍，这样加深理解。我们也留了很多很多坑在里面，看后面的代码再慢慢补上。</p>
<div class="note info"><p><strong>本文作者：</strong>意林<br><strong>本文链接：</strong><a href="http://shinancao.cn/2020/01/10/Vue-Source-Code-02/" target="_blank" rel="noopener">http://shinancao.cn/2020/01/10/Vue-Source-Code-02/</a><br><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" target="_blank" rel="noopener">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！</p>
</div>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
            <a href="/tags/Vue/" rel="tag"># Vue</a>
          
            <a href="/tags/源码分析/" rel="tag"># 源码分析</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/01/07/Vue-Source-Code-01/" rel="next" title="Vue.js源码学习 —— 合并选项前的预处理">
                <i class="fa fa-chevron-left"></i> Vue.js源码学习 —— 合并选项前的预处理
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/12/Vue-Source-Code-03/" rel="prev" title="Vue.js源码学习 —— VNode/createElement">
                Vue.js源码学习 —— VNode/createElement <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="gitment_container"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="意林">
          <p class="site-author-name" itemprop="name">意林</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">77</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">90</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/shinancao" target="_blank" rel="external nofollow" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/3178558825/profile?topnav=1&wvr=6&is_all=1" target="_blank" rel="external nofollow" title="微博">
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/150971507/" target="_blank" rel="external nofollow" title="豆瓣">
                  
                  豆瓣
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#预备知识"><span class="nav-number">1.</span> <span class="nav-text">预备知识</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Vue-options"><span class="nav-number">1.1.</span> <span class="nav-text">Vue.options</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#extend函数"><span class="nav-number">1.2.</span> <span class="nav-text">extend函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#各个选项的合并策略"><span class="nav-number">2.</span> <span class="nav-text">各个选项的合并策略</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#自定义合并选项的策略"><span class="nav-number">2.1.</span> <span class="nav-text">自定义合并选项的策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#el和propsData选项的合并策略"><span class="nav-number">2.2.</span> <span class="nav-text">el和propsData选项的合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#data选项的合并策略"><span class="nav-number">2.3.</span> <span class="nav-text">data选项的合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实例生命周期钩子选项的合并策略"><span class="nav-number">2.4.</span> <span class="nav-text">实例生命周期钩子选项的合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#资源选项的合并策略"><span class="nav-number">2.5.</span> <span class="nav-text">资源选项的合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#watch选项的合并策略"><span class="nav-number">2.6.</span> <span class="nav-text">watch选项的合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#props、methods、inject、computed选项的合并策略"><span class="nav-number">2.7.</span> <span class="nav-text">props、methods、inject、computed选项的合并策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#provide选项的合并策略"><span class="nav-number">2.8.</span> <span class="nav-text">provide选项的合并策略</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">意林</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






	
		
		
		
		<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
		<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
		<script>
			var gitment = new Gitment({
			  //id: '页面 ID',
			  owner: 'shinancao',
			  repo: 'shinancao.github.io',
			  oauth: {
				client_id: 'd9ac25dfb2084f02efb1',
				client_secret: '7b127bf1c8bccb72ea55c1220c0db3d3e505672e'
			  }
			});
			gitment.render('gitment_container');
		</script>
	


  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
