<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="JavaScript,Functional Programming," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.png?v=5.1.1" />






<meta name="description" content="《Functional Programming in JavaScript》笔记
这本书中的示例代码可以这里找到：https://github.com/luijar/functional-programming-js。

Part 1 —— 入门Why Functional?1)什么是函数式编程？以往我们也会写大量的function来解决问题，但是我们的function中封装的基本都是解决问题的">
<meta property="og:type" content="article">
<meta property="og:title" content="《Functional Programming in JavaScript》Note - Part1">
<meta property="og:url" content="http://shinancao.github.io/2019/04/01/Functional-JavaScript-Part1/index.html">
<meta property="og:site_name" content="意林的小站">
<meta property="og:description" content="《Functional Programming in JavaScript》笔记
这本书中的示例代码可以这里找到：https://github.com/luijar/functional-programming-js。

Part 1 —— 入门Why Functional?1)什么是函数式编程？以往我们也会写大量的function来解决问题，但是我们的function中封装的基本都是解决问题的">
<meta property="og:image" content="http://shinancao.github.io/images/decomposition.png">
<meta property="og:image" content="http://shinancao.github.io/images/oop_vs_fp.png">
<meta property="og:image" content="http://shinancao.github.io/images/table.png">
<meta property="og:image" content="http://shinancao.github.io/images/freeze.png">
<meta property="og:image" content="http://shinancao.github.io/images/closure.png">
<meta property="og:image" content="http://shinancao.github.io/images/scope.png">
<meta property="og:updated_time" content="2020-03-15T05:53:11.532Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="《Functional Programming in JavaScript》Note - Part1">
<meta name="twitter:description" content="《Functional Programming in JavaScript》笔记
这本书中的示例代码可以这里找到：https://github.com/luijar/functional-programming-js。

Part 1 —— 入门Why Functional?1)什么是函数式编程？以往我们也会写大量的function来解决问题，但是我们的function中封装的基本都是解决问题的">
<meta name="twitter:image" content="http://shinancao.github.io/images/decomposition.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://shinancao.github.io/2019/04/01/Functional-JavaScript-Part1/"/>





  <title>《Functional Programming in JavaScript》Note - Part1 | 意林的小站</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">意林的小站</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">Be a cool girl ~</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://shinancao.github.io/2019/04/01/Functional-JavaScript-Part1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="意林">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="意林的小站">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">《Functional Programming in JavaScript》Note - Part1</h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-01T06:40:32+08:00">
                2019-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>《Functional Programming in JavaScript》笔记</p>
<p>这本书中的示例代码可以这里找到：<a href="https://github.com/luijar/functional-programming-js" target="_blank" rel="external">https://github.com/luijar/functional-programming-js</a>。</p>
</blockquote>
<h1 id="Part-1-——-入门"><a href="#Part-1-——-入门" class="headerlink" title="Part 1 —— 入门"></a>Part 1 —— 入门</h1><h2 id="Why-Functional"><a href="#Why-Functional" class="headerlink" title="Why Functional?"></a>Why Functional?</h2><h3 id="1-什么是函数式编程？"><a href="#1-什么是函数式编程？" class="headerlink" title="1)什么是函数式编程？"></a>1)什么是函数式编程？</h3><p>以往我们也会写大量的function来解决问题，但是我们的function中封装的基本都是解决问题的过程，在函数式编程中，function不仅要来计算出一个结果，更要用它来抽象出控制流和对数据的操作，进而达到避免副作用、减少程序中的状态变化。函数式编程不是一种特殊的工具，而是一种解决问题的思路。</p>
<a id="more"></a>
<p>先来看个例子，在HTML中动态显示<code>Hello World</code>。最简单的做法：</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.<span class="built_in">querySelector</span>(<span class="string">'#msg'</span>).innerHTML = <span class="string">'&lt;h1&gt;Hello World&lt;/h1&gt;'</span>;</span><br></pre></td></tr></table></figure>
<p>这种写法虽然简单，但是所有的东西都是硬编码的，但凡要改变元素、标签或展示的内容，都需要重新更改上面的表达式。此时你可能想说那就把所有的可能变化的部分作为参数，然后封装一个function，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printMessage</span>(<span class="params">elementId, format, message</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.querySelector(<span class="string">`#<span class="subst">$&#123;elementId&#125;</span>`</span>).innerHTML = <span class="string">`&lt;<span class="subst">$&#123;format&#125;</span>&gt;<span class="subst">$&#123;message&#125;</span>&lt;/<span class="subst">$&#123;format&#125;</span>&gt;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的写法的确有所改善，但是可复用的粒度还不够，比如我不往HTML中展示东西了，而是往文件或者控制台中展示，上面的function又不适用了。我们将上面的功能进一步拆分成每个只干一件事的function，然后再按需组合起来，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addToDom</span>(<span class="params">elementId</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">content</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">`#<span class="subst">$&#123;elementId&#125;</span>`</span>).innerHTML = content</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">h1</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&lt;h1&gt;'</span> + message + <span class="string">'&lt;/h1&gt;'</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params">message</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> run = <span class="function"><span class="keyword">function</span>(<span class="params">f, g, h</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f(g(h(x)))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> printMessage = run(addToDom(<span class="string">'msg'</span>), h1, echo)</span><br><span class="line">printMessage(<span class="string">'Hello World'</span>)</span><br></pre></td></tr></table></figure>
<p>此时，如果换成往控制台重复打印，并将输出内容换成h2标签，则可以很快的实现，如下：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> printMessage = run(console<span class="selector-class">.log</span>, repeat(<span class="number">3</span>), <span class="selector-tag">h1</span>, echo)</span><br><span class="line"><span class="function"><span class="title">printMessage</span><span class="params">(<span class="string">'Get Functional'</span>)</span></span></span><br></pre></td></tr></table></figure>
<p>将一个酒店改造成KTV，可行，代价却很大，但是用一堆建筑材料来装修KTV，就容易很多了。要全面理解函数式编程还需要了解以下几个概念：</p>
<ul>
<li>声明式编程</li>
<li>纯函数</li>
<li>引用透明性</li>
<li>不可变性</li>
</ul>
<h4 id="函数式编程是声明式的"><a href="#函数式编程是声明式的" class="headerlink" title="函数式编程是声明式的"></a>函数式编程是声明式的</h4><p>我们最熟悉的面向对象编程（OOP）是命令式的，命令式的做法通常会定义一个从上到下改变程序状态的语句序列，以此来得到计算结果。比较典型的特征就是使用if、for、switch-case等来表述处理过程，最终得到一个结果。命令式频繁使用语句，代码描述的是控制流：即怎么做。</p>
<p>函数式编程（FP）是声明式的，也就是组合一系列表达式、操作符等来计算得到结果。声明式更多依赖表达式，代码描述的是数据流：即做什么。</p>
<p>看个例子对比一下，求一组数字的平方，命令式的做法如下：</p>
<figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var<span class="built_in"> array </span>= [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</span><br><span class="line">for(let i = 0; i &lt; array.length; i++) &#123;</span><br><span class="line">   array[i] = Math.pow(array[i], 2)     //循环计算每个数字的平方</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">//命令式编程详细地告诉计算机要怎样得到最终的结果</span><br></pre></td></tr></table></figure>
<p>而声明式的做法如下：</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>].map(<span class="name">function</span>(<span class="name">num</span>) &#123;</span><br><span class="line">    return Math.pow(<span class="name">num</span>, <span class="number">2</span>)             //map接收一个function来计算每个数字的平方</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line">//此时完全不用关心循环中的变量和过程中的取值了</span><br><span class="line">//ES6中引入了lambda表达式，上面可以进一步简化为</span><br><span class="line">[<span class="name">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>].map(<span class="name">num</span> =&gt; Math.pow(<span class="name">num</span>, <span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>这里说一下<code>.map</code>方法，<code>.map</code>是无法被break的，如果需要中断循环可以使用<code>Array.prototype.some</code>。<code>.map</code>主要的用途不在于循环，而是当你想要得到一个新数组时才使用。</p>
<h4 id="纯函数和副作用"><a href="#纯函数和副作用" class="headerlink" title="纯函数和副作用"></a>纯函数和副作用</h4><p>先看一个不是纯函数，会产生副作用的例子：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>            <span class="comment">//全局变量</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;     <span class="comment">//产生副作用：全局变量被改变了</span></span><br><span class="line">    <span class="keyword">return</span> ++counter</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//increment()的返回值变得不可预测，counter还有可能在别处被改变。</span></span><br></pre></td></tr></table></figure>
<p>那什么是纯函数？</p>
<pre><code>纯函数是这样一种函数，对于相同的输入，永远会得到相同的输出，而且没有任何可观察的副作用。
</code></pre><p>纯函数具有如下特性：</p>
<ul>
<li>输出结果只依赖于输入，不依赖于任何在它被调用或执行期间可能会发生变化的隐藏的或外部的状态。</li>
<li>不会造成它范围之外的改变，例如修改一个全局对象或一个传入的参数。</li>
</ul>
<p>什么又是副作用呢？</p>
<pre><code>副作用是在计算的过程中，系统状态的一种变化，或者与外界世界进行的可观察的交互。
</code></pre><p>副作用会在很多场景中产生，其中包括：</p>
<ul>
<li>改变全局的变量、属性或者数据结构</li>
<li>改变函数参数的初始值</li>
<li>处理用户输入</li>
<li>抛出异常，处分异常在同一个函数中被捕获到</li>
<li>像屏幕或日志打印</li>
<li>查询HTML documents，浏览器cookies，或database</li>
</ul>
<p>再来看一个稍微复杂一点的例子，通过社交帐号从数据库中查询对应的学生信息，然后展示在页面上。用带有副作用的命令式编程的做法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">showStudent</span>(<span class="params">ssn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> student = db.get(ssn)  <span class="comment">//暂时认为读db是一个同步的操作</span></span><br><span class="line">    <span class="keyword">if</span>(student !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">`#<span class="subst">$&#123;elementId&#125;</span>`</span>).innerHTML =    <span class="comment">//读取函数之外的变量elementId   </span></span><br><span class="line">        <span class="string">`<span class="subst">$&#123;student.ssn&#125;</span>,</span><br><span class="line">        <span class="subst">$&#123;student.firstname&#125;</span>,</span><br><span class="line">        <span class="subst">$&#123;student.lastname&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Student not found!'</span>)   <span class="comment">//无效时抛出异常</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">showStudent(<span class="string">'444-44-4444'</span>)   <span class="comment">//指定SSN为444-44-4444运行程序，并将得到的学生信息显示在页面中</span></span><br></pre></td></tr></table></figure>
<p>这里存在的副作用有：</p>
<ul>
<li>使用函数外部的<code>db</code>来获取数据，因为在函数参数中并没有定义它。而该引用随时可能变成null或者被改变，导致得到一个不同的结果。</li>
<li>全局变量<code>elementId</code>也有可能随时被改变。</li>
<li>HTML元素直接被改变了，而它本身是可变的、共享的、全局的资源。</li>
<li>在学生未被查询到时会抛出异常，这会导致整个程序栈错误并突然结束。</li>
</ul>
<p>对外部的依赖使得上面代码的可复用性、扩展性、可测试性都变得很难。现在用函数式的写法来分解上面的代码：</p>
<ul>
<li>将这个很长的函数拆分成多个短的函数，每一个函数只干一件事。</li>
<li>明确指定函数需要的参数，以此来减少副作用。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> find = curry(<span class="function"><span class="keyword">function</span>(<span class="params">db, id</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> obj = db.get(id)</span><br><span class="line">    <span class="keyword">if</span> (obj === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Object not found!'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//抛出异常的函数式处理会在Part2中讲到，需要先了解单子</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> csv = (student) =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;student.ssn&#125;</span>, <span class="subst">$&#123;student.firstname&#125;</span>, <span class="subst">$&#123;student.lastname&#125;</span>`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> append = curry(<span class="function"><span class="keyword">function</span>(<span class="params">elementId, info</span>) </span>&#123;</span><br><span class="line">	 <span class="comment">//将可变的部分单独抽离出来</span></span><br><span class="line">    <span class="built_in">document</span>.querySelector(elementId).innerHTML = info</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//curry的作用是把函数的参数减少到1个，Part2中会具体介绍</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> showStudent = run(</span><br><span class="line">    append(<span class="string">'#student-info'</span>),</span><br><span class="line">    csv,</span><br><span class="line">    find(db))</span><br><span class="line"></span><br><span class="line">showStudent(<span class="string">'444-44-4444'</span>)</span><br></pre></td></tr></table></figure>
<h4 id="引用透明性和可替代性"><a href="#引用透明性和可替代性" class="headerlink" title="引用透明性和可替代性"></a>引用透明性和可替代性</h4><pre><code>如果一个函数对于同一输入始终产生相同的结果，则称其为引用透明性。
</code></pre><p>引用透明性使得我们能够推断出程序的运行结果，程序中的表达式可以替换成它的执行结果。将上面counter的例子改成纯函数，与之前的写法做一对比：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//命令式版本</span></span><br><span class="line"><span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">increment</span><span class="params">()</span></span></span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(counter)</span></span>  <span class="comment">//-&gt; ?  打印的结果依赖于counter的初始值，因此变得不可预测</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//函数式版本</span></span><br><span class="line"><span class="selector-tag">var</span> increment = counter =&gt; counter + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">var</span> plus2 = run(increment, increment)</span><br><span class="line"><span class="function"><span class="title">print</span><span class="params">(run(<span class="number">0</span>)</span></span>)  <span class="comment">//-&gt; 2   打印的结果始终都是初始值加2</span></span><br></pre></td></tr></table></figure>
<p>再来看个例子，计算学生的平均成绩：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> sum = (total, current) =&gt; total + current</span><br><span class="line"><span class="selector-tag">var</span> total = arr =&gt; arr.reduce(sum)</span><br><span class="line"><span class="selector-tag">var</span> size = arr =&gt; arr<span class="selector-class">.length</span></span><br><span class="line"><span class="selector-tag">var</span> divide = (<span class="selector-tag">a</span>, b) =&gt; <span class="selector-tag">a</span> / <span class="selector-tag">b</span></span><br><span class="line"><span class="selector-tag">var</span> average = arr =&gt; divide(total(arr), size(arr))</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">var</span> <span class="selector-tag">input</span> = [<span class="number">80</span>, <span class="number">90</span>, <span class="number">100</span>]</span><br><span class="line"><span class="function"><span class="title">average</span><span class="params">(input)</span></span>  <span class="comment">//-&gt; 90</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//因为divide具有引用透明性，所以完全可以将上面的表达式改写如下：</span></span><br><span class="line"><span class="selector-tag">var</span> average = divide(<span class="number">270</span>, <span class="number">3</span>)  <span class="comment">//-&gt; 90</span></span><br></pre></td></tr></table></figure>
<h4 id="保持数据不可变"><a href="#保持数据不可变" class="headerlink" title="保持数据不可变"></a>保持数据不可变</h4><p>不可变的数据是指一旦它被创建就不能再被改变了。在JavaScript中，所有的基本类型都是不可变的，如<code>String</code>、<code>Number</code>。但是其他的对象，像数组，就是可变的，即使它作为参数被传入也有可能被改变，因而产生副作用。比如对数组进行倒序排列：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> sortDesc = function(arr) &#123;</span><br><span class="line">    return arr.sort(function(<span class="selector-tag">a</span>, b) &#123;</span><br><span class="line">        return <span class="selector-tag">b</span> - <span class="selector-tag">a</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</span><br><span class="line"><span class="function"><span class="title">sortDesc</span><span class="params">(arr)</span></span>  <span class="comment">//-&gt; [9,8,7,6,5,4,3,2,1]</span></span><br><span class="line"><span class="comment">//arr的初始值被改变了</span></span><br></pre></td></tr></table></figure>
<p><em>这种情况要怎样来克服呢？</em></p>
<p>了解了以上这些函数式编程的基本原则，现在我们可以用一句来概括一下：</p>
<pre><code>函数式编程通过避免外部可观察的副作用来对纯函数进行声明式运算以创建不可变的程序。
</code></pre><h3 id="2-函数式编程带来的好处"><a href="#2-函数式编程带来的好处" class="headerlink" title="2)函数式编程带来的好处"></a>2)函数式编程带来的好处</h3><h4 id="促使我们将复杂任务分解成简单的功能"><a href="#促使我们将复杂任务分解成简单的功能" class="headerlink" title="促使我们将复杂任务分解成简单的功能"></a>促使我们将复杂任务分解成简单的功能</h4><p>函数式编程做的事其实就是分解和组合，就像前面在处理查询和展示学生信息的例子。先把任务分解成多个没有副作用的function，然后再通过一定手段将这些function组合起来。<code>run</code>其实是<code>compose</code>的别名，做的事就是让一个function的返回值成为下一个function的参数。</p>
<p><img src="/images/decomposition.png"></p>
<p>也可以用数学表达式的方式来表示：<code>f • g = f(g(x))</code></p>
<h4 id="用链式处理数据"><a href="#用链式处理数据" class="headerlink" title="用链式处理数据"></a>用链式处理数据</h4><p>要把分解后的function组合起来不止上面<code>compose</code>一种方式，还可以通过一连串的对上一个函数返回值的函数的调用，来得到最终的结果。这样使得每一步做的事情清晰可见，通过还隐藏的具体的处理细节。举个例子，假设我们要计算出注册了不止一个班级的学生的平均成绩。</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//采用命令式编程的方式实现</span></span><br><span class="line"><span class="keyword">var</span> totalGrades = <span class="number">0</span></span><br><span class="line"><span class="keyword">var</span> totalStudentsFound = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; enrollment.length; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> student = enrollment[i]</span><br><span class="line">    <span class="keyword">if</span> (student !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (student.enrolled &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            totalGrades += student.grade</span><br><span class="line">            totalStudentsFound++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> average = totalGrades / totalStudentsFound <span class="comment">//-&gt; 90</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//采用函数链的方式实现</span></span><br><span class="line">_.chain(enrollment)</span><br><span class="line"> .filter(student =&gt; student.enrolled &gt; <span class="number">1</span>)</span><br><span class="line"> .pluck(<span class="string">'grade'</span>)</span><br><span class="line"> .average()</span><br><span class="line"> .<span class="keyword">value</span>()  <span class="comment">//-&gt; 90</span></span><br></pre></td></tr></table></figure>
<p>上面的链式调用是用<a href="https://github.com/lodash/lodash" target="_blank" rel="external">Lodash.js</a>实现的。链式调用还能够做到惰性计算（Lazy Evaluation），按需调用，减少循环的次数和中间爱数组的产生，以此提高性能。关于惰性计算可以看一下这篇文章的讲解：<a href="https://segmentfault.com/a/1190000006998998" target="_blank" rel="external">https://segmentfault.com/a/1190000006998998</a>。</p>
<h4 id="应对异步程序的复杂性"><a href="#应对异步程序的复杂性" class="headerlink" title="应对异步程序的复杂性"></a>应对异步程序的复杂性</h4><p>对于异步事件结果的处理我们通常用的是回调(<code>callback</code>），使用<code>callback</code>的问题在于它打破了代码的线性流程，一旦异步事件嵌套的层级多了，代码就变得难易阅读。近几年大热的<code>React</code>系列很好的解决了该问题。</p>
<p>这些<code>React</code>框架采用的响应式编程，其实就是基于函数式编程的。这些框架让事件（包括鼠标点击、输入框改变、光标改变、HTTP请求、数据库查询、文件写入等等）具有可观察性，事件的处理者就可以订阅事件产生的数据流，然后组合和链接一系列操作（如<code>map</code>、<code>reduce</code>…）对数据进行处理。这本书中用到的框架是<a href="https://github.com/reactivex/rxjs" target="_blank" rel="external">RxJS</a>。</p>
<p>来看一个校验文本框输入的社交帐号是否有效的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//命令式编程的做法</span></span><br><span class="line"><span class="keyword">var</span> valid = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> elem = <span class="built_in">document</span>.querySelector(<span class="string">'#student-ssn'</span>);</span><br><span class="line">elem.onkeyup = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">var</span> val = elem.value;</span><br><span class="line">	<span class="keyword">if</span>(val !== <span class="literal">null</span> &amp;&amp; val.length !== <span class="number">0</span>) &#123;</span><br><span class="line">		val = val.replace(<span class="regexp">/^\s*|\s*$|\-/g</span>, <span class="string">''</span>);</span><br><span class="line">		<span class="keyword">if</span>(val.length === <span class="number">9</span>) &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">`Valid SSN: <span class="subst">$&#123;val&#125;</span>!`</span>);</span><br><span class="line">			valid = <span class="literal">true</span>;</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">`Invalid SSN: <span class="subst">$&#123;val&#125;</span>!`</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//函数式编程的做法，使用RxJS框架处理</span></span><br><span class="line">Rx.Observable.fromEvent(<span class="built_in">document</span>.querySelector(<span class="string">'#student-ssn'</span>), <span class="string">'keyup'</span>)</span><br><span class="line">  .pluck(<span class="string">'srcElement'</span>, <span class="string">'value'</span>)</span><br><span class="line">  .map(ssn =&gt; ssn.replace(<span class="regexp">/^\s*|\s*$|\-/g</span>, <span class="string">''</span>))</span><br><span class="line">  .filter(ssn =&gt; ssn !== <span class="literal">null</span> &amp;&amp; ssn.length === <span class="number">9</span>)</span><br><span class="line">  .subscribe(validSsn =&gt; &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">`Valid SSN <span class="subst">$&#123;validSsn&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Why-JavaScript"><a href="#Why-JavaScript" class="headerlink" title="Why JavaScript?"></a>Why JavaScript?</h2><p>为什么要学习JavaScript？因为它已经无处不在，几乎可以开发各种类型的应用。<br>为什么JavaScript可以实现函数式编程？因为它支持高阶函数、闭包、数组字面值等等。其实，函数是JavaScript的主要工作单位，这意味这函数不仅可以驱动应用的行为，也可以来定义对象、模块和处理事件。</p>
<h3 id="1-函数式编程VS面向对象编程"><a href="#1-函数式编程VS面向对象编程" class="headerlink" title="1)函数式编程VS面向对象编程"></a>1)函数式编程VS面向对象编程</h3><p><img src="/images/oop_vs_fp.png"><br>OOP侧重于创建继承关系，并把方法和数据紧紧的绑在一起。而函数式编程偏向于多态函数，支持不同的数据类型，避免使用<code>this</code>。</p>
<p><img src="/images/table.png"></p>
<p>举个例子，定义一个<code>Person</code>class，再定义一个<code>Student</code>class继承自<code>Person</code>。现在给定一个<code>person</code>实例，找到跟他在同一个国家的所有朋友。给定一个<code>student</code>实例，找到其他同学跟他在同一个国家并且在一个学校的同学。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//略去对Person类和Student类的定义了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//面向对象编程的做法</span></span><br><span class="line"><span class="comment">// Person class</span></span><br><span class="line">peopleInSameCountry(friends) &#123;</span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> idx <span class="keyword">in</span> friends) &#123;</span><br><span class="line">        <span class="keyword">var</span> friend = friends [idx];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.address.country === friend.address.country) &#123;</span><br><span class="line">            result.push(friend);</span><br><span class="line">        &#125;</span><br><span class="line">	 &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Student class</span></span><br><span class="line">studentsInSameCountryAndSchool(friends) &#123;</span><br><span class="line">    <span class="keyword">var</span> closeFriends = <span class="keyword">super</span>.peopleInSameCountry(friends);  <span class="comment">//使用super调用父类的方法</span></span><br><span class="line">    <span class="keyword">var</span> result = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> idx <span class="keyword">in</span> closeFriends) &#123;</span><br><span class="line">        <span class="keyword">var</span> friend = closeFriends[idx];</span><br><span class="line">        <span class="keyword">if</span> (friend.school === <span class="keyword">this</span>.school) &#123;</span><br><span class="line">            result.push(friend);</span><br><span class="line">        &#125;</span><br><span class="line">	 &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一组Student实例</span></span><br><span class="line"><span class="keyword">var</span> curry = <span class="keyword">new</span> Student(<span class="string">'Haskell'</span>, <span class="string">'Curry'</span>,</span><br><span class="line">     <span class="string">'111-11-1111'</span>, <span class="string">'Penn State'</span>);</span><br><span class="line">curry.address = <span class="keyword">new</span> Address(<span class="string">'US'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> turing = <span class="keyword">new</span> Student(<span class="string">'Alan'</span>, <span class="string">'Turing'</span>,</span><br><span class="line">     <span class="string">'222-22-2222'</span>, <span class="string">'Princeton'</span>);</span><br><span class="line">turing.address = <span class="keyword">new</span> Address(<span class="string">'England'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> church = <span class="keyword">new</span> Student(<span class="string">'Alonzo'</span>, <span class="string">'Church'</span>,</span><br><span class="line">   <span class="string">'333-33-3333'</span>, <span class="string">'Princeton'</span>);</span><br><span class="line">church.address = <span class="keyword">new</span> Address(<span class="string">'US'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> kleene = <span class="keyword">new</span> Student(<span class="string">'Stephen'</span>, <span class="string">'Kleene'</span>,</span><br><span class="line">    <span class="string">'444-44-4444'</span>, <span class="string">'Princeton'</span>);</span><br><span class="line">kleene.address = <span class="keyword">new</span> Address(<span class="string">'US'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用上面定在Student类中的方法找到符合要求的学生</span></span><br><span class="line">church.studentsInSameCountryAndSchool([curry, turing, kleene]);</span><br><span class="line"><span class="comment">//-&gt; [kleene]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//接下来用函数式编程来解决，把问题分解成更小的function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">selector</span>(<span class="params">country, school</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">student</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> student.address.country() === country &amp;&amp;</span><br><span class="line">          student.school() === school;</span><br><span class="line">	&#125;; </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> findStudentsBy = <span class="function"><span class="keyword">function</span>(<span class="params">friends, selector</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> friends.filter(selector);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">findStudentsBy([curry, turing, church, kleene],</span><br><span class="line">  selector(<span class="string">'US'</span>, <span class="string">'Princeton'</span>));</span><br><span class="line">  </span><br><span class="line"><span class="comment">//-&gt; [church, kleene]</span></span><br></pre></td></tr></table></figure>
<h3 id="2-保持JavaScript对象的不可变"><a href="#2-保持JavaScript对象的不可变" class="headerlink" title="2)保持JavaScript对象的不可变"></a>2)保持JavaScript对象的不可变</h3><p>JavaScript对象是高度动态的，你可以在任何时间点修改、添加或删除它的属性。这虽然可以用来做很多投机取巧的事情，但却跟维护中到大型的项目带来了极大的困难。要如何来克服JavaScript对象的可变性呢？</p>
<h4 id="采用值对象模式（Value-Object-Pattern）"><a href="#采用值对象模式（Value-Object-Pattern）" class="headerlink" title="采用值对象模式（Value Object Pattern）"></a>采用值对象模式（Value Object Pattern）</h4><p>值对象说的是判断两个对象是否相等应该是对象的“值”相等，而不是它俩必须是同一个对象。个人理解值对象其实类似于C++或Swift中定义的不可变结构体。来看一下JavaScript中是怎样实现值对象的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">zipCode</span>(<span class="params">code, location</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _code = code</span><br><span class="line">    <span class="keyword">let</span> _location = location || <span class="string">''</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        code: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _code</span><br><span class="line">        &#125;,</span><br><span class="line">        location: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _location</span><br><span class="line">        &#125;,</span><br><span class="line">        fromString: <span class="function"><span class="keyword">function</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">let</span> parts = str.split(<span class="string">'_'</span>)</span><br><span class="line">            <span class="keyword">return</span> zipCode(parts[<span class="number">0</span>], parts[<span class="number">1</span>])</span><br><span class="line">        &#125;,</span><br><span class="line">        toString: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _code + <span class="string">'-'</span> + _location</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> princetonZip = zipCode(<span class="string">'08544'</span>, <span class="string">'3345'</span>)</span><br><span class="line">princetonZip.toString()</span><br></pre></td></tr></table></figure>
<p>上面的做法，通过返回一组方法给调用者，保证了<code>zipCode</code>能够被访问到，却无法被修改，间接把<code>_code</code>和<code>_location</code>变成了私有属性。再来看一个通过返回copy的对象实现不可变性：</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">coordinate</span>(<span class="params">lat, long</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> _lat = lat</span><br><span class="line">    <span class="keyword">let</span> _long = long</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attribute">latitude</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _lat</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attribute">longitude</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> _long</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attribute">translate</span>: <span class="function"><span class="keyword">function</span>(<span class="params">dx, dy</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">coordinate</span>(_lat + dx, _lat + dy)  <span class="comment">//返回一个copy对象</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attribute">toString</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'('</span> + _lat + <span class="string">','</span> + _long + <span class="string">')'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> greenwich = <span class="built_in">coordinate</span>(<span class="number">51.4778</span>, <span class="number">0.0015</span>)</span><br><span class="line">greenwich.toString()  <span class="comment">//-&gt; (51.4778,0.0015)</span></span><br><span class="line">greenwich.translate(<span class="number">10</span>, <span class="number">10</span>).toString()  <span class="comment">//-&gt; (61.4778,61.4778)</span></span><br></pre></td></tr></table></figure>
<h4 id="使用Object-freeze-防止对象状态被修改"><a href="#使用Object-freeze-防止对象状态被修改" class="headerlink" title="使用Object.freeze()防止对象状态被修改"></a>使用Object.freeze()防止对象状态被修改</h4><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> person = Object.freeze(new Person(<span class="string">'Haskell'</span>, <span class="string">'Curry'</span>, <span class="string">'444-44-4444'</span>))</span><br><span class="line">person<span class="selector-class">.firstname</span> = <span class="string">'Bob'</span>  <span class="comment">//这句话会导致报错，属性不允许被修改</span></span><br></pre></td></tr></table></figure>
<p>但是在对象嵌套的情况下，被嵌套的对象的属性此时还是可以修改的。</p>
<p><img src="/images/freeze.png"></p>
<p>解决办法就是手动对所有嵌套的对象都使用Object.freeze()：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isObject = (val) =&gt; val &amp;&amp; <span class="built_in">Object</span>.prototype.toString.call(val) == <span class="string">"[object Object]"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">deepFreeze</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isObject(obj) &amp;&amp; !<span class="built_in">Object</span>.isFrozen(obj)) &#123;</span><br><span class="line">        <span class="built_in">Object</span>.keys(obj).forEach(name =&gt; deepFreeze(obj[name]))</span><br><span class="line">        <span class="built_in">Object</span>.freeze(obj)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    deepFreeze: deepFreeze</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用lenses修改对象"><a href="#使用lenses修改对象" class="headerlink" title="使用lenses修改对象"></a>使用<code>lenses</code>修改对象</h4><p>对于对象类型，必不可少的要对其属性进行set，在OOP中一旦调用set对象的状态必然被修改。为了防止被修改，可以向下面这样做：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> lastname(lastname) &#123;</span><br><span class="line">    <span class="keyword">return</span> new Person(<span class="keyword">this</span>._firstname, lastname, <span class="keyword">this</span>._ssn)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是我们要给对象的所有属性都这样写，是一件相当令人崩溃的事，这时候就可以用到业界称之为的<code>lenses</code>的技术了。<code>lenses</code>简单的说就是函数式的<code>getter/setter</code>，现有的一些框架已经做了封装，不需要我们再一点点来实现。这本书中用到的是<a href="https://github.com/ramda/ramda" target="_blank" rel="external">Ramda</a>。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> person = new Person(<span class="string">'Alonzo'</span>, <span class="string">'Church'</span>, <span class="string">'444-44-4444'</span>)</span><br><span class="line"><span class="selector-tag">var</span> lastnameLens = R.lenseProp(<span class="string">'lastName'</span>)</span><br><span class="line"><span class="comment">//读属性值</span></span><br><span class="line">R.view(lastnameLens, person) <span class="comment">//-&gt;  'Church'</span></span><br><span class="line"><span class="comment">//设置属性值</span></span><br><span class="line"><span class="selector-tag">var</span> newPerson = R.set(lastnameLens, <span class="string">'Mourning'</span>, person)</span><br><span class="line">newPerson<span class="selector-class">.lastname</span>           <span class="comment">//-&gt; 'Mourning'</span></span><br><span class="line">person<span class="selector-class">.lastname</span>              <span class="comment">//-&gt; 'Church'</span></span><br></pre></td></tr></table></figure>
<p>因为<code>lenses</code>实现了不可变的setters，所以在改变嵌套对象时仍能返回一个新的对象。</p>
<figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//补上person的address</span></span><br><span class="line">person.address = new Address(</span><br><span class="line">   <span class="string">'US'</span>, <span class="string">'NJ'</span>, <span class="string">'Princeton'</span>, zipCode(<span class="string">'08544'</span>,<span class="string">'1234'</span>),</span><br><span class="line">   <span class="string">'Alexander St.'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个`lens`获取address.zip</span></span><br><span class="line">var zipPath = [<span class="string">'address'</span>, <span class="string">'zip'</span>]</span><br><span class="line">var zipLens = R.lens(R.<span class="built_in">path</span>(zipPath), R.assocPath(zipPath))</span><br><span class="line">R.<span class="function"><span class="title">view</span>(zipLens, person)     //-&gt;</span> zipCode(<span class="string">'08544'</span>,<span class="string">'1234'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//重新设置zipCode，会返回一个新的person</span></span><br><span class="line">var newPerson = R.set(zipLens, person, zipCode(<span class="string">'90210'</span>, <span class="string">'5678'</span>))</span><br><span class="line">R.<span class="function"><span class="title">view</span>(zipLens, newPerson)  //-&gt;</span> zipCode(<span class="string">'90210'</span>, <span class="string">'5678'</span>)</span><br><span class="line">R.<span class="function"><span class="title">view</span>(zipLens, person)     //-&gt;</span> zipCode(<span class="string">'08544'</span>, <span class="string">'1234'</span>)</span><br><span class="line">newPerson !== person</span><br></pre></td></tr></table></figure>
<h3 id="3-函数"><a href="#3-函数" class="headerlink" title="3)函数"></a>3)函数</h3><p>成全JavaScript非常适合编写函数式程序的两个重要特性是：函数是一等公民和高阶函数。</p>
<h4 id="函数是一等公民"><a href="#函数是一等公民" class="headerlink" title="函数是一等公民"></a>函数是一等公民</h4><p>函数作为一等公民（first-class）意味着：</p>
<ul>
<li>可以把匿名函数或lambda表达式赋值给一个变量</li>
</ul>
<figure class="highlight cos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var square = function (<span class="keyword">x</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">x</span> * <span class="keyword">x</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var square = <span class="keyword">x</span> =&gt; <span class="keyword">x</span> * <span class="keyword">x</span></span><br></pre></td></tr></table></figure>
<ul>
<li>赋值给对象属性</li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	method: <span class="function"><span class="keyword">function</span> <span class="params">(x)</span> </span>&#123; <span class="keyword">return</span> x * x &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>函数也可以通过构造器被实例化</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> multiplier = new Function(<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'return a * b'</span>)</span><br><span class="line"><span class="function"><span class="title">multiplier</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//在JavaScript中，每个函数都是Function类型的实例</span></span><br></pre></td></tr></table></figure>
<h4 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h4><p>当函数作为参数被传入，或作为返回值被返回时，这样的函数就叫做<em>高阶函数</em>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//演示函数作为参数被传入</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">applyOperation</span><span class="params">(a, b, opt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> opt(a, b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> multiplier = (a, b) =&gt; a * b</span><br><span class="line"></span><br><span class="line">applyOperation(<span class="number">2</span>, <span class="number">3</span>, multiplier)  <span class="comment">//-&gt; 6</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//演示函数作为返回值被返回</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span><span class="params">(a)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">(b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a + b</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">3</span>)(<span class="number">3</span>)  <span class="comment">//-&gt; 6</span></span><br></pre></td></tr></table></figure>
<p>刚接触这块时可能有点绕，始终要牢记一点：在一个函数后面写了<code>()</code>，那这个函数就被立即执行了。</p>
<h4 id="函数的调用类型"><a href="#函数的调用类型" class="headerlink" title="函数的调用类型"></a>函数的调用类型</h4><p>说一说函数以不同方式被调用时，<code>this</code>指代的上下文：</p>
<ul>
<li>作为全局函数——<code>this</code>指代的是全局对象或undefined（在严格模式下）</li>
</ul>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function doWork() &#123;</span><br><span class="line">	this<span class="selector-class">.myVar</span> = <span class="string">'Some Value'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">doWork</span><span class="params">()</span></span>  <span class="comment">//调用全局函数doWork()，使得this指向全局对象</span></span><br></pre></td></tr></table></figure>
<ul>
<li>作为方法——<code>this</code>指代的是方法的拥有者，这是JavaScript的面向对象性质重要的一部分。</li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	prop: <span class="string">'Some property'</span>,</span><br><span class="line">	getProp: <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">this</span>.prop &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">obj.getProp()   <span class="comment">//`this`指代的是obj</span></span><br></pre></td></tr></table></figure>
<ul>
<li>作为构造器用<code>new</code>来调用——<code>this</code>指代的是新被创建出来的对象。</li>
</ul>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyType</span><span class="params">(arg)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.prop = arg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> someVal = <span class="keyword">new</span> MyType(<span class="string">'some argument'</span>)</span><br></pre></td></tr></table></figure>
<p><code>this</code>是典型的面向对象的产物，它的不确定性使得代码很难理解，在函数式编程中应尽量避免使用<code>this</code>。</p>
<h4 id="函数方法"><a href="#函数方法" class="headerlink" title="函数方法"></a>函数方法</h4><p>函数方法就是像<code>call</code>和<code>apply</code>这样可以调用函数的方法，它们使得能够从一个已有的函数创建出新的函数。两个方法使用类似，<code>call</code>第二个参数为参数列表，<code>apply</code>第二个参数为数组。</p>
<figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Function</span>.proto<span class="keyword">type</span>.apply(thisArg, [argsArray])</span><br><span class="line"><span class="type">Function</span>.proto<span class="keyword">type</span>.call(thisArg, arg1,arg2,...)</span><br></pre></td></tr></table></figure>
<p>当<code>thisArg</code>为null时，被调用的函数的context为全局对象。当<code>thisArg</code>不为null时，context就是<code>thisArg</code>指向的对象。举例说明：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">negate</span>(<span class="params">func</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    	<span class="comment">//执行传入的func，此时func的context为全局对象</span></span><br><span class="line">    	<span class="keyword">return</span> !func.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isNull</span>(<span class="params">val</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> val === <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> isNotNull = negate(isNull)</span><br><span class="line"></span><br><span class="line">isNotNull(<span class="literal">null</span>)               <span class="comment">//-&gt; false</span></span><br><span class="line">isNotNull(&#123;&#125;)                 <span class="comment">//-&gt; true</span></span><br></pre></td></tr></table></figure>
<h3 id="4-闭包和作用域"><a href="#4-闭包和作用域" class="headerlink" title="4)闭包和作用域"></a>4)闭包和作用域</h3><h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>一个闭包的构成如下：</p>
<p><img src="/images/closure.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明全局变量</span></span><br><span class="line"><span class="keyword">var</span> outerVar = <span class="string">'Outer'</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeInner</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">	 <span class="comment">//声明局部变量</span></span><br><span class="line">    <span class="keyword">var</span> innerVar = <span class="string">'Inner'</span></span><br><span class="line">    <span class="comment">//声明inner: innerVar和outerVar是inner闭包的一部分</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`I can see: <span class="subst">$&#123;outerVar&#125;</span>, <span class="subst">$&#123;innerVar&#125;</span>, and <span class="subst">$&#123;params&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用makeInner返回inner函数</span></span><br><span class="line"><span class="keyword">var</span> inner = makeInner(<span class="string">'Params'</span>)</span><br><span class="line">inner() <span class="comment">//-&gt; 'I can see: Outer, Inner, and Params'</span></span><br></pre></td></tr></table></figure>
<h4 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h4><p>JavaScript中，当你定义一个变量，这个变量的作用域要么是全局作用域（global scope），要么属于函数作用域（function scope）。</p>
<p>JavaScript没有块级作用域（pseudo-block scope），所以一个变量要么是全局变量（定义在任何函数之外），要么是局部变量（定义在函数内，属于该函数）。</p>
<p>JavaScript的作用域工作机制是这样的：</p>
<ol>
<li>检查变量的function scope。</li>
<li>如果不是局部变量，会再向外检查lexical scope，直到搜索到global scope。</li>
<li>如果变量没有被引用，JavaScript就会返回undefined。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="string">'Some value'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parentFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">innerFunction</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="keyword">return</span> innerFunction;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> inner = parentFunction();</span><br><span class="line">inner();</span><br></pre></td></tr></table></figure>
<p>对于上面变量<code>x</code>，查找过程如下：</p>
<p><img src="/images/scope.png"></p>
<p>关于函数的作用更具体的介绍可以看一下这篇文章：<a href="http://creeperyang.github.io/2015/01/JavaScript-dynamic-scope-vs-static-scope/" target="_blank" rel="external">http://creeperyang.github.io/2015/01/JavaScript-dynamic-scope-vs-static-scope/</a>。</p>
<h4 id="闭包的实际应用"><a href="#闭包的实际应用" class="headerlink" title="闭包的实际应用"></a>闭包的实际应用</h4><ul>
<li>模拟私有变量</li>
</ul>
<p>这个在<code>zipCode</code>和<code>coordinate</code>例子中已经展示过了，返回一组变量的get方法。</p>
<ul>
<li>使用IIFE创建Module Pattern</li>
</ul>
<p>IIFE有两种形式：</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123; <span class="comment">/* code */</span> &#125;())  <span class="comment">//括号内的表达式代表函数立即调用表达式</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span><span class="params">()</span></span>&#123; <span class="comment">/* code */</span> &#125;)()  <span class="comment">//括号内的表达式代表函数表达式</span></span><br></pre></td></tr></table></figure>
<p>关于JavaScript的IIFE的具体分析介绍可以看这篇文章：<a href="https://segmentfault.com/a/1190000003985390" target="_blank" rel="external">https://segmentfault.com/a/1190000003985390</a>。</p>
<p>利用IIFE我们就可以来实现Module Pattern，Module Pattern将处理一个功能的代码快紧密的封装在一起，只暴露出需要给别人使用的变量和方法。一个封装良好的Module，具有可维护性，可复用性，还能避免命名空间的污染。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyModule = (<span class="function"><span class="keyword">function</span> (<span class="params">my</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    my.publicProperty = <span class="string">'I am a public property'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> _privateProperty = <span class="string">'Hello World'</span></span><br><span class="line"></span><br><span class="line">    my.method1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(_privateProperty)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    my.method2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> my</span><br><span class="line">&#125;(MyModule || &#123;&#125;))  <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">MyModule.method1()</span><br><span class="line">MyModule.method2()</span><br></pre></td></tr></table></figure>
<p>关于JavaScript的Module Pattern的详细介绍可以看这篇文章：<a href="https://www.cnblogs.com/Alex--Yang/p/3505285.html" target="_blank" rel="external">https://www.cnblogs.com/Alex--Yang/p/3505285.html</a>。</p>
<ul>
<li>进行异步的服务器端调用</li>
</ul>
<p>就是高阶函数作为回调（callback）被使用：</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">getJSON('/students',</span><br><span class="line">    (<span class="name">students</span>) =&gt; &#123;</span><br><span class="line">        getJSON('/students/grades',</span><br><span class="line">            grades =&gt; processGrades(<span class="name">grades</span>),</span><br><span class="line">            error =&gt; console.log(<span class="name">error</span>.message))</span><br><span class="line">    &#125;,</span><br><span class="line">    (<span class="name">error</span>) =&gt; </span><br><span class="line">        console.log(<span class="name">error</span>.message)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<ul>
<li>创建块级作用域变量</li>
</ul>
<p>可以用闭包将循环体进行封装，避免暴露循环过程中的计数器等：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">arr.<span class="keyword">forEach</span>(<span class="function"><span class="keyword">function</span><span class="params">(elem, i)</span> </span>&#123;</span><br><span class="line">   ...</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>转载请注明出处：</p>
<p>作者：意林</p>
<p>原文链接：<a href="http://www.shinancao.cn/2019/04/01/Functional-JavaScript-Part1" target="_blank" rel="external">http://www.shinancao.cn/2019/04/01/Functional-JavaScript-Part1</a></p>
</blockquote>
<p>–End–</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JavaScript/" rel="tag"># JavaScript</a>
          
            <a href="/tags/Functional-Programming/" rel="tag"># Functional Programming</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/05/Life-RuSang/" rel="next" title="此间的少年 —— 读《如丧》">
                <i class="fa fa-chevron-left"></i> 此间的少年 —— 读《如丧》
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/27/Programming-Git-Remote/" rel="prev" title="说一说git的几个命令remote、checkout、fetch、pull">
                说一说git的几个命令remote、checkout、fetch、pull <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="gitment_container"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="意林" />
          <p class="site-author-name" itemprop="name">意林</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
           
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">50</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">71</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/shinancao" target="_blank" rel="external nofollow" title="GitHub">
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/3178558825/profile?topnav=1&wvr=6&is_all=1" target="_blank" rel="external nofollow" title="微博">
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.douban.com/people/150971507/" target="_blank" rel="external nofollow" title="豆瓣">
                  
                  豆瓣
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Part-1-——-入门"><span class="nav-number">1.</span> <span class="nav-text">Part 1 —— 入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-Functional"><span class="nav-number">1.1.</span> <span class="nav-text">Why Functional?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-什么是函数式编程？"><span class="nav-number">1.1.1.</span> <span class="nav-text">1)什么是函数式编程？</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#函数式编程是声明式的"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">函数式编程是声明式的</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#纯函数和副作用"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">纯函数和副作用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#引用透明性和可替代性"><span class="nav-number">1.1.1.3.</span> <span class="nav-text">引用透明性和可替代性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#保持数据不可变"><span class="nav-number">1.1.1.4.</span> <span class="nav-text">保持数据不可变</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-函数式编程带来的好处"><span class="nav-number">1.1.2.</span> <span class="nav-text">2)函数式编程带来的好处</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#促使我们将复杂任务分解成简单的功能"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">促使我们将复杂任务分解成简单的功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#用链式处理数据"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">用链式处理数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#应对异步程序的复杂性"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">应对异步程序的复杂性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Why-JavaScript"><span class="nav-number">1.2.</span> <span class="nav-text">Why JavaScript?</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-函数式编程VS面向对象编程"><span class="nav-number">1.2.1.</span> <span class="nav-text">1)函数式编程VS面向对象编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-保持JavaScript对象的不可变"><span class="nav-number">1.2.2.</span> <span class="nav-text">2)保持JavaScript对象的不可变</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#采用值对象模式（Value-Object-Pattern）"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">采用值对象模式（Value Object Pattern）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用Object-freeze-防止对象状态被修改"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">使用Object.freeze()防止对象状态被修改</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#使用lenses修改对象"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">使用lenses修改对象</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-函数"><span class="nav-number">1.2.3.</span> <span class="nav-text">3)函数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#函数是一等公民"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">函数是一等公民</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#高阶函数"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">高阶函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数的调用类型"><span class="nav-number">1.2.3.3.</span> <span class="nav-text">函数的调用类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#函数方法"><span class="nav-number">1.2.3.4.</span> <span class="nav-text">函数方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-闭包和作用域"><span class="nav-number">1.2.4.</span> <span class="nav-text">4)闭包和作用域</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#闭包"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">闭包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#作用域"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">作用域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#闭包的实际应用"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">闭包的实际应用</span></a></li></ol></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">意林</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io" rel="external nofollow">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" rel="external nofollow">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






	
		
		
		
		<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
		<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
		<script>
			var gitment = new Gitment({
			  //id: '页面 ID',
			  owner: 'shinancao',
			  repo: 'shinancao.github.io',
			  oauth: {
				client_id: 'd9ac25dfb2084f02efb1',
				client_secret: '7b127bf1c8bccb72ea55c1220c0db3d3e505672e'
			  }
			});
			gitment.render('gitment_container');
		</script>
	


  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
